FROM ubuntu:24.04

ENV DEBIAN_FRONTEND=noninteractive

RUN apt-get update && \
    apt-get install -y build-essential wget libpam0g-dev libselinux1-dev zlib1g-dev \
    pkg-config libssl-dev git ca-certificates vim && \
    rm -rf /var/lib/apt/lists/*

RUN ln -s /etc/bash.bashrc /etc/bashrc && \
    if id ubuntu; then userdel -f -r ubuntu; fi && \
    find / -xdev -type f -perm -4000 -exec chmod u-s {} \;

WORKDIR /tmp
RUN wget https://www.sudo.ws/dist/sudo-1.8.0.tar.gz && \
    tar xzf sudo-1.8.0.tar.gz && \
    cd sudo-1.8.0 && \
    ./configure --disable-gcrypt --prefix=/usr && make -j$(nproc) && make install

RUN rm -rf /tmp/sudo*
